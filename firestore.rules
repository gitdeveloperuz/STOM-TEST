
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // -------------------------
    // Helper Functions
    // -------------------------
    function isSignedIn() {
      return true; 
    }

    // -------------------------
    // Standard Collections (Recursive Access)
    // -------------------------
    
    match /admins/{document=**} {
      allow read, write: if true; 
    }

    match /categories/{document=**} {
      allow read, write: if true;
    }
    
    match /treatments/{document=**} {
      allow read, write: if true;
    }

    match /site_config/{document=**} {
      allow read, write: if true;
    }

    match /tg_users/{document=**} {
      allow read, write: if true;
    }
    
    match /sessions/{document=**} {
      allow read, write: if true;
    }

    match /analytics/{document=**} {
      allow read, write: if true;
    }
    
    match /analytics_events/{document=**} {
      allow read, write: if true;
    }
    
    match /bot_states/{document=**} {
      allow read, write: if true;
    }

    // -------------------------
    // Dynamic Collections (Chats)
    // -------------------------
    // Allow access to any collection starting with 'chat_'
    match /{collectionName}/{document=**} {
      allow read, write: if collectionName.matches('^chat_.*');
    }
  }
}
